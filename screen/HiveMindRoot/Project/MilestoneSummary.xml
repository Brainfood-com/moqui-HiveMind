<?xml version="1.0" encoding="UTF-8"?>
<!--
This is free and unencumbered software released into the public domain.
For specific language governing permissions and limitations refer to
the LICENSE.md file or http://unlicense.org
-->
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-1.5.xsd"
        default-menu-include="false">

    <parameter name="milestoneWorkEffortId" required="true"/>
    <parameter name="milestoneWorkEffortId_0"/>

    <transition name="projectSummary"><default-response url="../ProjectSummary"/></transition>
    <transition name="editTask"><default-response url="../../Task/TaskSummary"/></transition>
    <transition name="updateTask">
        <service-call name="mantle.work.TaskServices.update#Task" in-map="context"/>
        <default-response url="."/>
    </transition>

    <pre-actions>
        <set field="milestoneWorkEffortId" from="milestoneWorkEffortId ?: milestoneWorkEffortId_0"/>
    </pre-actions>
    <actions>
        <entity-find-one entity-name="mantle.work.effort.WorkEffort" value-field="milestoneWorkEffort">
            <field-map field-name="workEffortId" from="milestoneWorkEffortId"/>
        </entity-find-one>
        <entity-find entity-name="WorkEffortAssocAndTo" list="inactiveTaskList">
            <econdition field-name="fromWorkEffortId" from="milestoneWorkEffortId"/>
            <econdition field-name="workEffortTypeEnumId" value="WetTask"/>
            <econdition field-name="statusId" operator="in" value="WeInPlanning,WeApproved,WeOnHold"/>
            <order-by field-name="priority"/><order-by field-name="estimatedCompletionDate"/>
        </entity-find>
        <entity-find entity-name="WorkEffortAssocAndTo" list="activeTaskList">
            <econdition field-name="fromWorkEffortId" from="milestoneWorkEffortId"/>
            <econdition field-name="workEffortTypeEnumId" value="WetTask"/>
            <econdition field-name="statusId" value="WeInProgress"/>
            <order-by field-name="priority"/><order-by field-name="estimatedCompletionDate"/>
        </entity-find>
        <entity-find entity-name="WorkEffortAssocAndTo" list="doneTaskList">
            <econdition field-name="fromWorkEffortId" from="milestoneWorkEffortId"/>
            <econdition field-name="workEffortTypeEnumId" value="WetTask"/>
            <econdition field-name="statusId" operator="in" value="WeComplete,WeClosed"/>
            <order-by field-name="priority"/><order-by field-name="estimatedCompletionDate"/>
        </entity-find>
    </actions>
    <widgets>
        <label text="Summary for Milestone &quot;${milestoneWorkEffort.workEffortName}&quot; - ${milestoneWorkEffortId}" type="h1"/>
        <link text="Project Summary" url="projectSummary" link-type="anchor-button">
            <parameter name="rootWorkEffortId" from="milestoneWorkEffort.rootWorkEffortId"/></link>
        <label text="Inactive Tasks" type="h2"/>
        <form-list name="InactiveTaskList" list="inactiveTaskList" transition="updateTask" multi="true"
                extends="component://HiveMind/screen/HiveMindAdmin/Project/MilestoneSummary.xml#InactiveTaskList">
        </form-list>

        <label text="Active Tasks" type="h2"/>
        <form-list name="ActiveTaskList" list="activeTaskList" transition="updateTask" extends="InactiveTaskList">
        </form-list>

        <label text="Completed Tasks" type="h2"/>
        <form-list name="DoneTaskList" list="doneTaskList" transition="updateTask" extends="InactiveTaskList">
        </form-list>
    </widgets>
</screen>
